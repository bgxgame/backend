# My-Life-Planner 项目系统梳理与总结

根据对项目的全面分析，以下是"My-Life-Planner"（我的生活计划器）项目的系统梳理与总结：

## 1. 项目概述

这是一个基于Rust和Axum框架开发的生活计划管理后端系统，旨在帮助用户管理个人计划和任务。项目采用现代化的Web技术栈，提供了完整的用户认证和计划管理功能。

## 2. 技术栈

- **Web框架**: Axum (Rust)
- **异步运行时**: Tokio
- **数据库**: PostgreSQL (通过SQLx)
- **数据序列化**: Serde/serde_json
- **密码哈希**: Argon2
- **JWT认证**: jsonwebtoken
- **日志追踪**: tracing
- **CORS支持**: tower-http

## 3. 核心功能

### 3.1 用户系统
- **用户注册**: 创建新用户账号，密码使用Argon2加密存储
- **用户登录**: 验证用户身份并生成JWT令牌

### 3.2 计划管理
- **创建计划**: 用户可以创建新的计划/任务
- **获取计划**: 可以获取公开的计划列表
- **更新计划**: 修改已有的计划信息
- **删除计划**: 删除指定的计划

### 3.3 权限控制
- **公开/私有**: 计划可以设置为公开或私有
- **身份验证**: 受保护的API端点需要有效的JWT令牌

## 4. 数据模型

### 用户表 (users)
- ID (主键，自增)
- 用户名 (唯一)
- 密码哈希 (使用Argon2加密)
- 创建时间

### 计划表 (plans)
- ID (主键，自增)
- 用户ID (外键，关联用户表)
- 标题
- 描述
- 状态 (待办、进行中、已完成、归档)
- 分类 (工作、生活、学习等)
- 优先级
- 截止日期
- 公开性 (公开/私有)
- 创建和更新时间

## 5. API端点

- `GET /api/plans` - 获取公开计划列表（可选认证，登录后可看到自己的私有计划）
- `POST /api/register` - 用户注册
- `POST /api/login` - 用户登录
- `POST /api/plans` - 创建新计划（需认证）
- `PATCH /api/plans/:id` - 更新计划（需认证）
- `DELETE /api/plans/:id` - 删除计划（需认证）

## 6. 项目特点

1. **安全性**: 使用Argon2进行密码哈希，JWT进行身份验证
2. **CORS支持**: 支持跨域请求，便于前端集成
3. **错误处理**: 完善的错误处理机制，使用自定义AppError枚举
4. **数据库迁移**: 包含数据库结构的迁移脚本
5. **环境配置**: 通过.env文件管理配置

## 7. 项目结构

```
src/
├── main.rs          # 主程序入口，路由配置，CORS设置
├── models.rs        # 数据模型定义
├── handlers.rs      # API处理函数
├── auth.rs          # 认证模块（JWT、密码哈希）
└── error.rs         # 错误处理模块
```

## 8. 数据库设计

- 使用PostgreSQL作为数据库
- 用户表和计划表通过外键关联
- 计划表支持软删除的级联删除（用户删除时其计划也会被删除）
- 为提高查询效率，在user_id字段上创建了索引

## 9. 认证机制

- 使用JWT令牌进行身份验证
- 实现了自定义的AuthUser提取器，确保受保护路由的安全性
- 令牌有效期为24小时
- 通过中间件自动验证请求中的Authorization头部

## 10. 运行配置

- 服务器运行在localhost:3000端口
- 支持通过环境变量配置数据库连接和JWT密钥
- 使用tracing进行日志记录和调试

这个项目是一个功能完整、安全可靠的计划管理后端系统，具备了现代Web应用所需的核心功能，适合与前端应用配合使用。
### 用户注册

```shell
curl -X POST http://localhost:3000/api/register \
  -H "Content-Type: application/json" \
  -d @register2.json
```